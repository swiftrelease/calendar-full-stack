(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(e,t,n){e.exports={TimeSlice:"TimeSlice_TimeSlice__RMlbL",TimeArea:"TimeSlice_TimeArea__X9z0w",EventArea:"TimeSlice_EventArea__1J2ft"}},12:function(e,t,n){e.exports={CalEvent:"CalendarEvent_CalEvent__1qIuX",Selected:"CalendarEvent_Selected__3B_nL"}},13:function(e,t,n){e.exports={Auth:"AuthForm_Auth__aDBu3",warning:"AuthForm_warning__3Pxnt"}},14:function(e,t,n){e.exports={Button:"Button_Button__3lFHW",Red:"Button_Red__UJqY3",Green:"Button_Green__TYQET",White:"Button_White__2Ukga",DeleteButton:"Button_DeleteButton__1BORa",Controls:"Button_Controls__hOqtp",AddButton:"Button_AddButton__pvLdm",SignOut:"Button_SignOut__33MQ7",Export:"Button_Export__DnoC-"}},21:function(e,t,n){e.exports={App:"App_App__2_CuX"}},23:function(e,t,n){e.exports={Calendar:"Calendar_Calendar__1HlCv"}},24:function(e,t,n){e.exports={Modal:"Modal_Modal__Ha-T5"}},25:function(e,t,n){e.exports={Backdrop:"Backdrop_Backdrop__nyqul"}},27:function(e,t,n){e.exports=n(54)},32:function(e,t,n){},51:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),s=n(20),o=n.n(s),c=(n(32),n(1)),i=n.n(c),l=n(2),u=n(6),d=n(7),p=n(9),h=n(8),v=n(10),m=n(21),f=n.n(m),E=n(22),k=n.n(E),y=n(15),b=n(26),g=n(23),w=n.n(g),x=n(11),S=n.n(x),_=n(12),T=n.n(_),O=n(14),C=n.n(O),j=function(e){var t=[C.a.Button];if(e.classes){var n=!0,r=!1,s=void 0;try{for(var o,c=e.classes[Symbol.iterator]();!(n=(o=c.next()).done);n=!0){var i=o.value;t.push(C.a[i])}}catch(l){r=!0,s=l}finally{try{n||null==c.return||c.return()}finally{if(r)throw s}}}return a.a.createElement("button",{type:"button",className:t.join(" "),onClick:e.click},e.children)},A=function(e){var t=e.selected?[T.a.CalEvent,T.a.Selected].join(" "):T.a.CalEvent;return a.a.createElement("div",{className:t,onClick:e.click,style:{width:e.style.width,height:e.style.height,top:e.style.offsetTop,left:e.style.left}},e.children,e.selected?a.a.createElement(j,{classes:["DeleteButton"],click:e.delete},"x"):null)},B=function(e){var t=null;if(e.events){var n=[];t=e.events.map(function(t,r){for(var s=10*(t.start-e.sliceStart)/3+"%",o=10*t.duration/3+"%",c="calc(".concat(s),i=0;i<n.length;i++){var l=n[i];c+=" - ".concat(l)}c+=")",n.push(o);var u=t.width,d=t.left;return a.a.createElement(A,{click:function(n){return e.selectEvent(n,t._id)},duration:t.duration,key:r,style:{offsetTop:c,height:o,width:u,left:d},selected:t.selected?t.selected:null,delete:t.selected?function(e){return t.deleteHandler(e,t._id)}:null},t.title)})}return a.a.createElement("div",{className:S.a.TimeSlice,style:e.small?null:{borderTop:"1px solid #ccc"}},a.a.createElement("div",{className:S.a.TimeArea,style:e.small?{fontSize:"12px"}:null},e.time),a.a.createElement("div",{className:S.a.EventArea},t))},H=function(e){return a.a.createElement(j,{click:e.click,classes:["AddButton"]},"+")},N=n(24),D=n.n(N),q=function(e){return e.children},z=n(25),J=n.n(z),P=function(e){return e.show?a.a.createElement("div",{className:J.a.Backdrop,onClick:e.clicked}):null},U=function(e){return a.a.createElement(q,null,a.a.createElement(P,{show:e.show,clicked:e.modalClosed}),a.a.createElement("div",{className:D.a.Modal,style:{transform:e.show?"translateY(0)":"translateY(-100vh)",opacity:e.show?"1":0}},e.children))},M=(n(51),function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(n=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(a)))).hours=[8,9,10,11,12,1,2,3,4],n.minutes=["00","05","10","15","20","25","30","35","40","45","50","55"],n.onEnter=function(e){"Enter"===e.key&&n.props.confirm()},n}return Object(v.a)(t,e),Object(d.a)(t,[{key:"setupOptions",value:function(e){return e.map(function(e){return a.a.createElement("option",{value:e,key:e},e)})}},{key:"render",value:function(){return a.a.createElement(q,null,a.a.createElement("h3",null,"Add event"),a.a.createElement("div",{className:"add-event-controls"},a.a.createElement("select",{id:"hours"},this.setupOptions(this.hours)),a.a.createElement("select",{id:"minutes"},this.setupOptions(this.minutes)),a.a.createElement("label",null,"Duration: "),a.a.createElement("input",{type:"text",id:"duration",onKeyDown:this.onEnter}),this.props.error&&"duration"===this.props.error.type?a.a.createElement("label",{className:"warning"},this.props.error.message):null,a.a.createElement("label",null,"Title: "),a.a.createElement("input",{type:"text",id:"title",onKeyDown:this.onEnter}),this.props.error&&"title"===this.props.error.type?a.a.createElement("label",{className:"warning"},this.props.error.message):null,a.a.createElement(j,{click:this.props.confirm,classes:["Green","Controls"]}," Add "),a.a.createElement(j,{click:this.props.cancel,classes:["White","Controls"]}," Cancel ")))}}]),t}(r.Component)),W="".concat("https://rem-calendar.herokuapp.com","/api/calendar"),I=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(n=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(a)))).state={events:[],addingEvent:!1,selectedEventId:null,addEventError:null,networkError:null},n.offsetEvents=[],n.getEventData=Object(l.a)(i.a.mark(function e(){var t,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(W,{method:"GET",headers:{"X-ApiToken":n.props.apiToken}});case 2:if(200!==(t=e.sent).status){e.next=10;break}return e.next=6,t.json();case 6:return r=e.sent,e.abrupt("return",r);case 10:n.setState({networkError:"Failed to connect to the server: ".concat(t.status,".")});case 11:case"end":return e.stop()}},e,this)})),n.containsOffsetEvent=function(e){var t=!0,r=!1,a=void 0;try{for(var s,o=n.offsetEvents[Symbol.iterator]();!(t=(s=o.next()).done);t=!0){var c=s.value;if(console.log(c._id,e._id),e._id===c._id)return!0}}catch(i){r=!0,a=i}finally{try{t||null==o.return||o.return()}finally{if(r)throw a}}return!1},n.calcEventStyle=function(e){var t=0,r=1,a=[],s=!0,o=!1,c=void 0;try{for(var i,l=n.state.events[Symbol.iterator]();!(s=(i=l.next()).done);s=!0){var u=i.value;n.eventsOverlap(e,u)&&e._id!==u._id&&(a.push(u),r++)}}catch(E){o=!0,c=E}finally{try{s||null==l.return||l.return()}finally{if(o)throw c}}for(var d=0;d<a.length-1;d++)for(var p=d+1;p<a.length;p++)n.eventsOverlap(a[d],a[p])||r--;for(var h=0;h<a.length;h++){var v=a[h];(e.start>v.start||e.start===v.start&&!n.containsOffsetEvent(v))&&(t++,n.offsetEvents.push(v))}var m,f=100/r*t;return m=f?"".concat(f,"%"):"0",{width:"calc(".concat(100/r,"% - 12px)"),left:m}},n.selectEventHandler=function(e,t){e.stopPropagation(),n.state.selectedEventId!==t&&n.setState({selectedEventId:t})},n.deselectEventHandler=function(){n.state.selectedEventId&&n.setState({selectedEventId:null})},n.addEventButtonClickHandler=function(){n.setState({addingEvent:!0})},n.addEventCancelHandler=function(){n.setState({addingEvent:!1})},n.closeErrorModalHandler=function(){n.setState({networkError:null})},n.deleteEventHandler=function(){var e=Object(l.a)(i.a.mark(function e(t,r){var a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.stopPropagation(),e.next=3,fetch(W,{method:"DELETE",headers:{"Content-Type":"application/json","X-ApiToken":n.props.apiToken},body:JSON.stringify({id:r})});case 3:if(200!==e.sent.status){e.next=17;break}a=Object(b.a)(n.state.events),s=0;case 7:if(!(s<a.length)){e.next=15;break}if(a[s]._id!==r){e.next=12;break}return a.splice(s,1),n.setState({events:a}),e.abrupt("break",15);case 12:s++,e.next=7;break;case 15:e.next=18;break;case 17:console.log("error with the request");case 18:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),n.addEventHandler=Object(l.a)(i.a.mark(function e(){var t,r,a,s,o,c,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=+document.querySelector("select#hours").value,r=+document.querySelector("select#minutes").value,a=+document.querySelector("input#duration").value,s=document.querySelector("input#title").value,!isNaN(a)){e.next=7;break}return n.setState({addEventError:{type:"duration",message:"Duration has to be a number"}}),e.abrupt("return");case 7:if(!(a<5||a>300)){e.next=10;break}return n.setState({addEventError:{type:"duration",message:"Duration has to be more than 5 and less than 300"}}),e.abrupt("return");case 10:if(s){e.next=13;break}return n.setState({addEventError:{type:"title",message:"Title cannot be empty"}}),e.abrupt("return");case 13:return t<5&&(t+=12),o=60*(t-8)+r,c=JSON.stringify({start:o,duration:a,title:s}),e.next=18,fetch(W,{method:"POST",headers:{"Content-Type":"application/json","X-ApiToken":n.props.apiToken},body:c});case 18:if(200!==e.sent.status){e.next=26;break}return e.next=22,n.getEventData();case 22:l=e.sent,n.setState({events:l,addingEvent:!1,addEventError:null}),e.next=27;break;case 26:console.log("HTTP request error");case 27:case"end":return e.stop()}},e,this)})),n.exportJsonHandler=Object(l.a)(i.a.mark(function e(){var t,r,a,s,o,c,l,u,d,p,h,v,m,f,E;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(E=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return new Uint8Array(t)},t=[],r=!0,a=!1,s=void 0,e.prev=5,o=n.state.events[Symbol.iterator]();!(r=(c=o.next()).done);r=!0)l=c.value,t.push({start:l.start,duration:l.duration,title:l.title});e.next=13;break;case 9:e.prev=9,e.t0=e.catch(5),a=!0,s=e.t0;case 13:e.prev=13,e.prev=14,r||null==o.return||o.return();case 16:if(e.prev=16,!a){e.next=19;break}throw s;case 19:return e.finish(16);case 20:return e.finish(13);case 21:for(u=0;u<t.length-1;u++)for(d=u+1;d<t.length;d++)t[d].start<t[u].start&&(p=t[u],t[u]=t[d],t[d]=p);h=E(JSON.stringify(t,null,2)),v=new Blob([h],{type:"application/octet-stream"}),m=URL.createObjectURL(v),(f=document.createElement("a")).href=m,f.download="events.json",f.click();case 29:case"end":return e.stop()}},e,this,[[5,9,13,21],[14,,16,20]])})),n}return Object(v.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=Object(l.a)(i.a.mark(function e(){var t,n,r,a,s,o,c,l,u,d,p,h,v,m,f,E,k,y;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getEventData();case 2:if(!(t=e.sent)){e.next=53;break}n=!0,r=!1,a=void 0,e.prev=7,s=t[Symbol.iterator]();case 9:if(n=(o=s.next()).done){e.next=38;break}for(c=o.value,l=100,u=1,d=[],p=!0,h=!1,v=void 0,e.prev=17,m=t[Symbol.iterator]();!(p=(f=m.next()).done);p=!0)E=f.value,this.eventsOverlap(c,E)&&c._id!==E._id&&(d.push(E),u++);e.next=25;break;case 21:e.prev=21,e.t0=e.catch(17),h=!0,v=e.t0;case 25:e.prev=25,e.prev=26,p||null==m.return||m.return();case 28:if(e.prev=28,!h){e.next=31;break}throw v;case 31:return e.finish(28);case 32:return e.finish(25);case 33:for(k=0;k<d.length-1;k++)for(y=k+1;y<d.length;y++)this.eventsOverlap(d[k],d[y])||u--;c.widthPercent=l/u;case 35:n=!0,e.next=9;break;case 38:e.next=44;break;case 40:e.prev=40,e.t1=e.catch(7),r=!0,a=e.t1;case 44:e.prev=44,e.prev=45,n||null==s.return||s.return();case 47:if(e.prev=47,!r){e.next=50;break}throw a;case 50:return e.finish(47);case 51:return e.finish(44);case 52:this.setState({events:t});case 53:case"end":return e.stop()}},e,this,[[7,40,44,52],[17,21,25,33],[26,,28,32],[45,,47,51]])}));return function(){return e.apply(this,arguments)}}()},{key:"eventsOverlap",value:function(e,t){return e.start<=t.start&&e.start+e.duration>t.start||t.start<=e.start&&t.start+t.duration>e.start}},{key:"getSliceStart",value:function(e,t){var n=e>5?60*(e-8):60*(e+4);return t&&(n+=30),n}},{key:"getEventsForSlice",value:function(e){var t=this,n=[],r=!0,a=!1,s=void 0;try{for(var o,c=this.state.events[Symbol.iterator]();!(r=(o=c.next()).done);r=!0){var i=o.value;i.start>=e&&i.start<e+30&&n.push(i)}}catch(l){a=!0,s=l}finally{try{r||null==c.return||c.return()}finally{if(a)throw s}}return n=n.map(function(e){var n=t.calcEventStyle(e),r=Object(y.a)({},e,{width:n.width,left:n.left});return r._id===t.state.selectedEventId&&(r=Object(y.a)({},r,{selected:!0,deleteHandler:t.deleteEventHandler})),r})}},{key:"setupTimeSlices",value:function(){for(var e=this.props.timeStart,t=this.props.timeSlicesAmount,n=!1,r=[],s=0,o=e;s<t;s++){var c=this.getSliceStart(o,n);r.push(a.a.createElement(B,{events:this.getEventsForSlice(c),selectEvent:this.selectEventHandler,small:n,time:"".concat(o,":").concat(n?"30":"00"),sliceStart:c,key:"".concat(o,":").concat(n?"30":"00")})),12===o&&n&&(o=0),n&&o++,n=!n}return r}},{key:"render",value:function(){console.log("re-render");var e=this.setupTimeSlices();return a.a.createElement("div",{className:w.a.Calendar,onClick:this.deselectEventHandler},a.a.createElement(U,{show:this.state.addingEvent||this.state.networkError,modalClosed:this.state.networkError?this.closeErrorModalHandler:this.addEventCancelHandler},this.state.addingEvent?a.a.createElement(M,{cancel:this.addEventCancelHandler,confirm:this.addEventHandler,error:this.state.addEventError}):null,this.state.networkError?a.a.createElement("h3",null,this.state.networkError):null),e,a.a.createElement(j,{click:this.props.signOut,classes:["White","SignOut"]}," Sign Out "),a.a.createElement(j,{click:this.exportJsonHandler,classes:["White","Export"]}," \u21e9 "),a.a.createElement(H,{click:this.addEventButtonClickHandler}))}}]),t}(r.Component),L=n(13),F=n.n(L),R=function(e){function t(t){"Enter"===t.key&&e.authorize(t)}return a.a.createElement("div",{className:F.a.Auth},a.a.createElement("h2",null,"Log in or create a new account"),a.a.createElement("label",null,"Username:"),a.a.createElement("input",{type:"text",id:"uname",onKeyDown:t}),e.error&&"uname"===e.error.type?a.a.createElement("label",{className:F.a.warning},e.error.message):null,a.a.createElement("label",null,"Password:"),a.a.createElement("input",{type:"password",id:"pass",onKeyDown:t}),e.error&&"pass"===e.error.type?a.a.createElement("label",{className:F.a.warning},e.error.message):null,a.a.createElement(j,{classes:["White"],click:e.authorize},"Submit"))},X="".concat("https://rem-calendar.herokuapp.com","/auth"),G=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(n=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(a)))).state={authorized:!1,authError:null,apiToken:null},n.componentDidMount=Object(l.a)(i.a.mark(function e(){var t,r,a,s,o,c,l,u,d,p;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=document.cookie.split("; "),r=null,a=!0,s=!1,o=void 0,e.prev=5,c=t[Symbol.iterator]();case 7:if(a=(l=c.next()).done){e.next=15;break}if("authToken"!==(u=l.value).split("=")[0]){e.next=12;break}return r=u.split("=")[1],e.abrupt("break",15);case 12:a=!0,e.next=7;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(5),s=!0,o=e.t0;case 21:e.prev=21,e.prev=22,a||null==c.return||c.return();case 24:if(e.prev=24,!s){e.next=27;break}throw o;case 27:return e.finish(24);case 28:return e.finish(21);case 29:if(r){e.next=31;break}return e.abrupt("return");case 31:return e.next=33,fetch(X,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({authToken:r})});case 33:if(200!==(d=e.sent).status){e.next=39;break}return e.next=37,d.json();case 37:(p=e.sent).uname&&p.apiToken&&n.setState({authorized:!0,uname:p.uname,apiToken:p.apiToken});case 39:case"end":return e.stop()}},e,this,[[5,17,21,29],[22,,24,28]])})),n.setAuthError=function(e,t){return!!e&&(n.setState({authError:t}),!0)},n.authorizationHandler=Object(l.a)(i.a.mark(function e(){var t,r,a,s,o,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.querySelector("input#uname").value,r=document.querySelector("input#pass").value,!(n.setAuthError(!t,{type:"uname",message:"Username required"})||n.setAuthError(!r,{type:"pass",message:"Password required"})||n.setAuthError(t.length<4,{type:"uname",message:"Username has to be at least 4 characters"})||n.setAuthError(r.length<6,{type:"pass",message:"Password has to be at least 6 characters"}))){e.next=4;break}return e.abrupt("return");case 4:return a=k()("sha256").update(r).digest("hex"),e.next=7,fetch(X,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uname:t,pass:a})});case 7:if(200!==(s=e.sent).status){e.next=15;break}return e.next=11,s.json();case 11:(o=e.sent).action&&o.authToken&&o.apiToken?("register"===o.action&&(document.cookie="authToken=".concat(o.authToken),n.setState({authorized:!0,apiToken:o.apiToken,uname:t})),"login"===o.action&&(document.cookie="authToken=".concat(o.authToken),n.setState({authorized:!0,apiToken:o.apiToken,uname:t}))):o.error?n.setState({authError:{type:"pass",message:o.error}}):n.setState({authError:{type:"pass",message:"Unknown auth error"}}),e.next=20;break;case 15:return e.next=17,s.json();case 17:return(c=e.sent).error?n.setState({authError:{type:"pass",message:c.error}}):n.setState({authError:{type:"pass",message:"Unknown auth error"}}),e.abrupt("return");case 20:case"end":return e.stop()}},e,this)})),n.signOutHandler=function(){document.cookie="authToken=;expires=".concat(new Date(0).toUTCString()),n.setState({authorized:!1,apiToken:null})},n}return Object(v.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:f.a.App},this.state.authorized?a.a.createElement(I,{timeStart:8,timeSlicesAmount:19,apiToken:this.state.apiToken,signOut:this.signOutHandler}):a.a.createElement(R,{error:this.state.authError,authorize:this.authorizationHandler}))}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(G,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[27,2,1]]]);
//# sourceMappingURL=main.f8c48773.chunk.js.map