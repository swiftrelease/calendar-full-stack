(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(e,t,n){e.exports={TimeSlice:"TimeSlice_TimeSlice__RMlbL",TimeArea:"TimeSlice_TimeArea__X9z0w",EventArea:"TimeSlice_EventArea__1J2ft"}},12:function(e,t,n){e.exports={CalEvent:"CalendarEvent_CalEvent__1qIuX",Selected:"CalendarEvent_Selected__3B_nL"}},13:function(e,t,n){e.exports={Auth:"AuthForm_Auth__aDBu3",warning:"AuthForm_warning__3Pxnt"}},14:function(e,t,n){e.exports={Button:"Button_Button__3lFHW",Red:"Button_Red__UJqY3",Green:"Button_Green__TYQET",White:"Button_White__2Ukga",DeleteButton:"Button_DeleteButton__1BORa",Controls:"Button_Controls__hOqtp",AddButton:"Button_AddButton__pvLdm",SignOut:"Button_SignOut__33MQ7",Export:"Button_Export__DnoC-"}},22:function(e,t,n){e.exports={App:"App_App__2_CuX"}},24:function(e,t,n){e.exports={Calendar:"Calendar_Calendar__1HlCv"}},25:function(e,t,n){e.exports={Modal:"Modal_Modal__Ha-T5"}},26:function(e,t,n){e.exports={Backdrop:"Backdrop_Backdrop__nyqul"}},27:function(e,t,n){e.exports=n(54)},32:function(e,t,n){},51:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(21),s=n.n(o),l=(n(32),n(1)),c=n.n(l),i=n(2),u=n(6),d=n(7),p=n(9),h=n(8),v=n(10),m=n(22),f=n.n(m),E=n(23),k=n.n(E),g=n(16),y=n(15),b=n(24),w=n.n(b),x=n(11),S=n.n(x),_=n(12),T=n.n(_),O=n(14),C=n.n(O),B=function(e){var t=[C.a.Button];if(e.classes){var n=!0,a=!1,o=void 0;try{for(var s,l=e.classes[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var c=s.value;t.push(C.a[c])}}catch(i){a=!0,o=i}finally{try{n||null==l.return||l.return()}finally{if(a)throw o}}}return r.a.createElement("button",{type:"button",className:t.join(" "),onClick:e.click},e.children)},A=function(e){var t=e.selected?[T.a.CalEvent,T.a.Selected].join(" "):T.a.CalEvent;return r.a.createElement("div",{className:t,onClick:e.click,style:{width:e.style.width,height:e.style.height,top:e.style.offsetTop,left:e.style.left}},e.children,e.selected?r.a.createElement(B,{classes:["DeleteButton"],click:e.delete},"x"):null)},j=function(e){var t=null;if(e.events){var n=[];t=e.events.map(function(t,a){for(var o=10*(t.start-e.sliceStart)/3+"%",s=10*t.duration/3+"%",l="calc(".concat(o),c=0;c<n.length;c++){var i=n[c];l+=" - ".concat(i)}l+=")",n.push(s);var u=t.width,d=t.left;return r.a.createElement(A,{click:function(n){return e.selectEvent(n,t._id)},duration:t.duration,key:a,style:{offsetTop:l,height:s,width:u,left:d},selected:t.selected?t.selected:null,delete:t.selected?function(e){return t.deleteHandler(e,t._id)}:null},t.title)})}return r.a.createElement("div",{className:S.a.TimeSlice,style:e.small?null:{borderTop:"1px solid #ccc"}},r.a.createElement("div",{className:S.a.TimeArea,style:e.small?{fontSize:"12px"}:null},e.time),r.a.createElement("div",{className:S.a.EventArea},t))},H=function(e){return r.a.createElement(B,{click:e.click,classes:["AddButton"]},"+")},N=n(25),D=n.n(N),q=function(e){return e.children},z=n(26),M=n.n(z),J=function(e){return e.show?r.a.createElement("div",{className:M.a.Backdrop,onClick:e.clicked}):null},P=function(e){return r.a.createElement(q,null,r.a.createElement(J,{show:e.show,clicked:e.modalClosed}),r.a.createElement("div",{className:D.a.Modal,style:{transform:e.show?"translateY(0)":"translateY(-100vh)",opacity:e.show?"1":0}},e.children))},U=(n(51),function(e){function t(e){return e.map(function(e){return r.a.createElement("option",{value:e,key:e},e)})}function n(t){"Enter"===t.key&&e.confirm()}return r.a.createElement(q,null,r.a.createElement("h3",null,"Add event"),r.a.createElement("div",{className:"add-event-controls"},r.a.createElement("select",{id:"hours"},t([8,9,10,11,12,1,2,3,4])),r.a.createElement("select",{id:"minutes"},t(["00","05","10","15","20","25","30","35","40","45","50","55"])),r.a.createElement("label",null,"Duration: "),r.a.createElement("input",{type:"text",id:"duration",onKeyDown:n,placeholder:"Duration in minutes"}),e.error&&"duration"===e.error.type?r.a.createElement("label",{className:"warning"},e.error.message):null,r.a.createElement("label",null,"Title: "),r.a.createElement("input",{type:"text",id:"title",onKeyDown:n,placeholder:"Event title"}),e.error&&"title"===e.error.type?r.a.createElement("label",{className:"warning"},e.error.message):null,r.a.createElement(B,{click:e.confirm,classes:["Green","Controls"]}," Add "),r.a.createElement(B,{click:e.cancel,classes:["White","Controls"]}," Cancel ")))}),W="".concat("https://rem-calendar.herokuapp.com","/api/calendar"),I=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={events:[],addingEvent:!1,selectedEventId:null,addEventError:null,networkError:null},n.styledEvents=[],n.getEventData=Object(i.a)(c.a.mark(function e(){var t,a;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(W,{method:"GET",headers:{"X-ApiToken":n.props.apiToken}});case 2:if(200!==(t=e.sent).status){e.next=10;break}return e.next=6,t.json();case 6:return a=e.sent,e.abrupt("return",a);case 10:n.setState({networkError:"Failed to connect to the server: ".concat(t.status,".")});case 11:case"end":return e.stop()}},e,this)})),n.componentDidMount=Object(i.a)(c.a.mark(function e(){var t;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getEventData();case 2:(t=e.sent)&&n.setState({events:t});case 4:case"end":return e.stop()}},e,this)})),n.containsOffsetEvent=function(e){var t=!0,a=!1,r=void 0;try{for(var o,s=n.offsetEvents[Symbol.iterator]();!(t=(o=s.next()).done);t=!0){var l=o.value;if(e._id===l._id)return!0}}catch(c){a=!0,r=c}finally{try{t||null==s.return||s.return()}finally{if(a)throw r}}return!1},n.setStyledEvents=function(){for(var e=Object(y.a)(n.state.events),t=0;t<e.length-1;t++)for(var a=t+1;a<e.length;a++)if(e[t].start>e[a].start){var r=e[t];e[t]=e[a],e[a]=r}for(var o=0;o<e.length;o++){e[o].overlappingEvents=[],e[o].overlappingEventsBefore=[];for(var s=0;s<e.length;s++)n.eventsOverlap(e[o],e[s])&&(e[o].overlappingEvents.push(s),o>s&&e[o].overlappingEventsBefore.push(s))}for(var l=0;l<e.length;l++){var c=e[l];if(l>0&&c.overlappingEventsBefore.length>0)if(e[l-1].column>0){for(var i=0;i<e[l-1].column;i++)-1===c.overlappingEventsBefore.indexOf(l-(i+2))&&(c.column=e[l-(i+2)].column);"undefined"===typeof c.column&&(c.column=e[l-1].column+1)}else{for(var u=0,d=0;d<c.overlappingEventsBefore.length;d++)e[c.overlappingEventsBefore[c.overlappingEventsBefore.length-1-d]].column===u&&u++;c.column=u}else c.column=0}for(var p=0;p<e.length;p++)e[p].totalColumns=0,e[p].overlappingEvents.length>1&&function(){var t=[],n=[];!function a(r){for(var o=0;o<r.overlappingEvents.length;o++)-1===t.indexOf(r.overlappingEvents[o])&&(t.push(r.overlappingEvents[o]),n.push(e[r.overlappingEvents[o]].column),a(e[r.overlappingEvents[o]]))}(e[p]),e[p].totalColumns=Math.max.apply(Math,n)}(),e[p].width="calc(".concat(100/(e[p].totalColumns+1),"% - 12px)"),e[p].left="".concat(100/(e[p].totalColumns+1)*e[p].column,"%");n.styledEvents=e},n.selectEventHandler=function(e,t){e.stopPropagation(),n.state.selectedEventId!==t&&n.setState({selectedEventId:t})},n.deselectEventHandler=function(){n.state.selectedEventId&&n.setState({selectedEventId:null})},n.addEventButtonClickHandler=function(){n.setState({addingEvent:!0})},n.addEventCancelHandler=function(){n.setState({addingEvent:!1})},n.closeErrorModalHandler=function(){n.setState({networkError:null})},n.deleteEventHandler=function(){var e=Object(i.a)(c.a.mark(function e(t,a){var r,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.stopPropagation(),e.next=3,fetch(W,{method:"DELETE",headers:{"Content-Type":"application/json","X-ApiToken":n.props.apiToken},body:JSON.stringify({id:a})});case 3:if(200!==e.sent.status){e.next=17;break}r=Object(y.a)(n.state.events),o=0;case 7:if(!(o<r.length)){e.next=15;break}if(r[o]._id!==a){e.next=12;break}return r.splice(o,1),n.setState({events:r}),e.abrupt("break",15);case 12:o++,e.next=7;break;case 15:e.next=18;break;case 17:console.log("HTTP request error");case 18:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),n.addEventHandler=Object(i.a)(c.a.mark(function e(){var t,a,r,o,s,l,i;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=+document.querySelector("select#hours").value,a=+document.querySelector("select#minutes").value,r=+document.querySelector("input#duration").value,o=document.querySelector("input#title").value,!isNaN(r)){e.next=7;break}return n.setState({addEventError:{type:"duration",message:"Duration has to be a number"}}),e.abrupt("return");case 7:if(!(r<5||r>300)){e.next=10;break}return n.setState({addEventError:{type:"duration",message:"Duration has to be more than 5 and less than 300"}}),e.abrupt("return");case 10:if(o){e.next=13;break}return n.setState({addEventError:{type:"title",message:"Title cannot be empty"}}),e.abrupt("return");case 13:return t<5&&(t+=12),s=60*(t-8)+a,l=JSON.stringify({start:s,duration:r,title:o}),e.next=18,fetch(W,{method:"POST",headers:{"Content-Type":"application/json","X-ApiToken":n.props.apiToken},body:l});case 18:if(200!==e.sent.status){e.next=26;break}return e.next=22,n.getEventData();case 22:i=e.sent,n.setState({events:i,addingEvent:!1,addEventError:null}),e.next=27;break;case 26:console.log("HTTP request error");case 27:case"end":return e.stop()}},e,this)})),n.exportJsonHandler=Object(i.a)(c.a.mark(function e(){var t,a,r,o,s,l,i,u,d,p,h,v,m,f,E;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(E=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return new Uint8Array(t)},t=[],a=!0,r=!1,o=void 0,e.prev=5,s=n.state.events[Symbol.iterator]();!(a=(l=s.next()).done);a=!0)i=l.value,t.push({start:i.start,duration:i.duration,title:i.title});e.next=13;break;case 9:e.prev=9,e.t0=e.catch(5),r=!0,o=e.t0;case 13:e.prev=13,e.prev=14,a||null==s.return||s.return();case 16:if(e.prev=16,!r){e.next=19;break}throw o;case 19:return e.finish(16);case 20:return e.finish(13);case 21:for(u=0;u<t.length-1;u++)for(d=u+1;d<t.length;d++)t[d].start<t[u].start&&(p=t[u],t[u]=t[d],t[d]=p);h=E(JSON.stringify(t,null,2)),v=new Blob([h],{type:"application/octet-stream"}),m=URL.createObjectURL(v),(f=document.createElement("a")).href=m,f.download="events.json",f.click();case 29:case"end":return e.stop()}},e,this,[[5,9,13,21],[14,,16,20]])})),n}return Object(v.a)(t,e),Object(d.a)(t,[{key:"eventsOverlap",value:function(e,t){return e.start<=t.start&&e.start+e.duration>t.start||t.start<=e.start&&t.start+t.duration>e.start}},{key:"getSliceStart",value:function(e,t){var n=e>5?60*(e-8):60*(e+4);return t&&(n+=30),n}},{key:"getEventsForSlice",value:function(e){var t=this,n=[],a=!0,r=!1,o=void 0;try{for(var s,l=this.styledEvents[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;c.start>=e&&c.start<e+30&&n.push(c)}}catch(i){r=!0,o=i}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}return n=n.map(function(e){var n=Object(g.a)({},e);return n._id===t.state.selectedEventId&&(n=Object(g.a)({},n,{selected:!0,deleteHandler:t.deleteEventHandler})),n})}},{key:"setupTimeSlices",value:function(){for(var e=this.props.timeStart,t=this.props.timeSlicesAmount,n=!1,a=[],o=0,s=e;o<t;o++){var l=this.getSliceStart(s,n);a.push(r.a.createElement(j,{events:this.getEventsForSlice(l),selectEvent:this.selectEventHandler,small:n,time:"".concat(s,":").concat(n?"30":"00"),sliceStart:l,key:"".concat(s,":").concat(n?"30":"00")})),12===s&&n&&(s=0),n&&s++,n=!n}return a}},{key:"render",value:function(){this.setStyledEvents();var e=this.setupTimeSlices();return r.a.createElement("div",{className:w.a.Calendar,onClick:this.deselectEventHandler},r.a.createElement(P,{show:this.state.addingEvent||this.state.networkError,modalClosed:this.state.networkError?this.closeErrorModalHandler:this.addEventCancelHandler},this.state.addingEvent?r.a.createElement(U,{cancel:this.addEventCancelHandler,confirm:this.addEventHandler,error:this.state.addEventError}):null,this.state.networkError?r.a.createElement("h3",null,this.state.networkError):null),e,r.a.createElement(B,{click:this.props.signOut,classes:["White","SignOut"]}," Sign Out "),r.a.createElement(B,{click:this.exportJsonHandler,classes:["White","Export"]}," \u21e9 "),r.a.createElement(H,{click:this.addEventButtonClickHandler}))}}]),t}(a.Component),L=n(13),F=n.n(L),R=function(e){function t(t){"Enter"===t.key&&e.authorize(t)}return r.a.createElement("div",{className:F.a.Auth},r.a.createElement("h2",null,"Log in or create a new account"),r.a.createElement("label",null,"Username:"),r.a.createElement("input",{type:"text",id:"uname",onKeyDown:t}),e.error&&"uname"===e.error.type?r.a.createElement("label",{className:F.a.warning},e.error.message):null,r.a.createElement("label",null,"Password:"),r.a.createElement("input",{type:"password",id:"pass",onKeyDown:t}),e.error&&"pass"===e.error.type?r.a.createElement("label",{className:F.a.warning},e.error.message):null,r.a.createElement(B,{classes:["White"],click:e.authorize},"Submit"))},X="".concat("https://rem-calendar.herokuapp.com","/auth"),G=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={authorized:!1,authError:null,apiToken:null},n.componentDidMount=Object(i.a)(c.a.mark(function e(){var t,a,r,o,s,l,i,u,d,p;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=document.cookie.split("; "),a=null,r=!0,o=!1,s=void 0,e.prev=5,l=t[Symbol.iterator]();case 7:if(r=(i=l.next()).done){e.next=15;break}if("authToken"!==(u=i.value).split("=")[0]){e.next=12;break}return a=u.split("=")[1],e.abrupt("break",15);case 12:r=!0,e.next=7;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(5),o=!0,s=e.t0;case 21:e.prev=21,e.prev=22,r||null==l.return||l.return();case 24:if(e.prev=24,!o){e.next=27;break}throw s;case 27:return e.finish(24);case 28:return e.finish(21);case 29:if(a){e.next=31;break}return e.abrupt("return");case 31:return e.next=33,fetch(X,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({authToken:a})});case 33:if(200!==(d=e.sent).status){e.next=39;break}return e.next=37,d.json();case 37:(p=e.sent).uname&&p.apiToken&&n.setState({authorized:!0,uname:p.uname,apiToken:p.apiToken});case 39:case"end":return e.stop()}},e,this,[[5,17,21,29],[22,,24,28]])})),n.setAuthError=function(e,t){return!!e&&(n.setState({authError:t}),!0)},n.authorizationHandler=Object(i.a)(c.a.mark(function e(){var t,a,r,o,s,l;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.querySelector("input#uname").value,a=document.querySelector("input#pass").value,!(n.setAuthError(!t,{type:"uname",message:"Username required"})||n.setAuthError(!a,{type:"pass",message:"Password required"})||n.setAuthError(t.length<4,{type:"uname",message:"Username has to be at least 4 characters"})||n.setAuthError(a.length<6,{type:"pass",message:"Password has to be at least 6 characters"}))){e.next=4;break}return e.abrupt("return");case 4:return r=k()("sha256").update(a).digest("hex"),e.next=7,fetch(X,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uname:t,pass:r})});case 7:if(200!==(o=e.sent).status){e.next=15;break}return e.next=11,o.json();case 11:(s=e.sent).action&&s.authToken&&s.apiToken?("register"===s.action&&(document.cookie="authToken=".concat(s.authToken),n.setState({authorized:!0,apiToken:s.apiToken,uname:t})),"login"===s.action&&(document.cookie="authToken=".concat(s.authToken),n.setState({authorized:!0,apiToken:s.apiToken,uname:t}))):s.error?n.setState({authError:{type:"pass",message:s.error}}):n.setState({authError:{type:"pass",message:"Unknown auth error"}}),e.next=20;break;case 15:return e.next=17,o.json();case 17:return(l=e.sent).error?n.setState({authError:{type:"pass",message:l.error}}):n.setState({authError:{type:"pass",message:"Unknown auth error"}}),e.abrupt("return");case 20:case"end":return e.stop()}},e,this)})),n.signOutHandler=function(){document.cookie="authToken=;expires=".concat(new Date(0).toUTCString()),n.setState({authorized:!1,apiToken:null,authError:null})},n}return Object(v.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:f.a.App},this.state.authorized?r.a.createElement(I,{timeStart:8,timeSlicesAmount:19,apiToken:this.state.apiToken,signOut:this.signOutHandler}):r.a.createElement(R,{error:this.state.authError,authorize:this.authorizationHandler}))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(G,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[27,2,1]]]);
//# sourceMappingURL=main.015a7ee4.chunk.js.map